<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å°ç¥ç¦ Â· Love Notes</title>
  <meta name="description" content="å½•åˆ¶ä¸€æ®µå©šç¤¼ç¥ç¦è§†é¢‘ï¼Œå¹¶å±•ç¤ºæ¼‚äº®çš„ CSS åŠ¨ç”»ç¥ç¦è¯­ã€‚" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#ff8ab5; /* ä¸»é¢˜ç²‰ */
      --ink:#0f172a;  /* å¢¨è‰² */
      --bg:#0b0b10;  /* æ·±èƒŒæ™¯ */
      --passcode:"5201314"; /* æ”¹è¿™ä¸ªå°±æ˜¯ä½ çš„å°å¯†ç ï¼ˆä¸å®‰å…¨ï¼Œè½»ç”¨é€”ï¼‰*/
      --msg:"æ„¿ä½ ä»¬ç›¸æ¿¡ä»¥æ²«ï¼Œæ‰§å­ä¹‹æ‰‹ï¼Œä¸å­å•è€ ğŸ’"; /* é»˜è®¤ç¥ç¦è¯­ */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:#fff; background:radial-gradient(1200px 800px at 10% 10%, #201a2b 0%, #0b0b10 55%);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Noto Sans CJK SC", sans-serif;
      overflow:hidden; /* è®©èˆå°æ›´å¹²å‡€ */
    }

    /* â€”â€” ç™»å½•è’™å±‚ â€”â€” */
    .gate{
      position:fixed; inset:0; display:grid; place-items:center; background:rgba(9,9,12,.8); backdrop-filter: blur(10px);
      z-index:50; transition:opacity .5s ease;
    }
    .gate.hide{opacity:0; pointer-events:none}
    .card{ width:min(92vw,420px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1);
      border-radius:24px; padding:24px; box-shadow:0 20px 60px rgba(0,0,0,.5)}
    .title{font-weight:800; font-size:22px;letter-spacing:.4px}
    .muted{opacity:.75; font-size:14px; line-height:1.5}
    .field{margin-top:14px}
    .input{width:100%; padding:14px 16px; border-radius:14px; border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.06); color:#fff; outline:none}
    .btn{margin-top:14px; width:100%; padding:12px 16px; border:none; border-radius:14px; cursor:pointer;
      color:#1b1020; background:linear-gradient(135deg, #ffd1e3, var(--brand)); font-weight:700}
    .small{font-size:12px; opacity:.7; margin-top:10px}

    /* â€”â€” èˆå° â€”â€” */
    .stage{position:absolute; inset:0; display:grid; grid-template-rows:auto 1fr auto;}

    /* èƒŒæ™¯åŠ¨ç”»ï¼šLissajous å…‰ç‚¹ä½¿ç”¨ CSS ä¸‰è§’å‡½æ•° */
    .orbs{position:absolute; inset:0; pointer-events:none; filter: blur(10px) saturate(1.4)}
    .orb{position:absolute; width:18px; height:18px; border-radius:999px; background:radial-gradient(circle at 30% 30%, #fff, var(--brand)); opacity:.85;
      /* æˆ‘ä»¬ç”¨ä¸€ä¸ªè§’åº¦å˜é‡ --aï¼Œä» 0deg åŠ¨ç”»åˆ° 360degï¼Œç„¶åé€šè¿‡ sin()/cos() ç®—å‡º x,y */
      --a:0deg; animation: spin 9s linear infinite;
    }
    /* ä¸åŒè½¨è¿¹/ç›¸ä½ï¼Œç”Ÿæˆå¤šé¢—å…‰ç‚¹ */
    .orb[data-i="1"]{animation-duration:10s}
    .orb[data-i="2"]{animation-duration:11.5s}
    .orb[data-i="3"]{animation-duration:13s}
    .orb[data-i="4"]{animation-duration:15s}
    .orb[data-i="5"]{animation-duration:17s}

    @keyframes spin{
      0%{ --a: 0deg }
      100%{ --a: 360deg }
    }
    /* ç”¨ä¸‰è§’å‡½æ•°ç»˜åˆ¶æ¤­åœ†/Lissajous è·¯å¾„ï¼š
       x = sin(a) * Rx  + å±…ä¸­
       y = cos(a*2) * Ry + å±…ä¸­ ï¼ˆa*2 å½¢æˆæè¨å¦‚æ›²çº¿ï¼‰*/
    .orb{ 
      left: calc(50% + sin(var(--a)) * 40vw);
      top:  calc(45% + cos(calc(var(--a) * 2)) * 18vh);
    }

    /* ç¥ç¦æ–‡æ¡ˆ */
    .panel{place-self:center; text-align:center; padding:24px; z-index:1}
    .bless{font-size: clamp(26px, 5vw, 48px); font-weight:800; line-height:1.15; letter-spacing:.5px; text-wrap:balance}
    .sign{margin-top:10px; font: 400 20px/1.2 "Zhi Mang Xing", cursive; opacity:.9}

    /* æµªæ¼«å°å¿ƒå½¢ï¼ˆçº¯ CSSï¼‰ */
    .hearts{position:absolute; inset:0; pointer-events:none}
    .heart{position:absolute; width:16px; aspect-ratio:1; background:var(--brand); transform:rotate(45deg); opacity:.85; filter:drop-shadow(0 4px 8px rgba(255,0,70,.25));
      animation: floatUp 6s linear infinite; border-radius:4px 4px 0 0;}
    .heart::before,.heart::after{content:""; position:absolute; inset:0; border-radius:50%; background:var(--brand)}
    .heart::before{left:-50%}
    .heart::after{top:-50%}
    @keyframes floatUp{
      0%{ transform:translateY(20vh) rotate(45deg); opacity:0 }
      10%{opacity:.9}
      100%{ transform:translateY(-110vh) rotate(45deg); opacity:0 }
    }

    /* å½•åˆ¶åŒº */
    .rec{place-self:end center; margin:24px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); border-radius:20px; padding:16px; width:min(92vw,760px)}
    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center}
    .toolbar button{padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.15); background:rgba(255,255,255,.08); color:#fff; cursor:pointer}
    .toolbar button.primary{background:linear-gradient(135deg, #ffd1e3, var(--brand)); color:#1b1020; font-weight:800}
    video{width:100%; max-height:50vh; background:#000; border-radius:16px; margin-top:12px}

    /* é¡¶éƒ¨è§’æ ‡ */
    .badge{position:fixed; left:14px; top:14px; font-size:12px; opacity:.8}
    .badge a{color:#fff; text-decoration:none; border-bottom:1px dashed rgba(255,255,255,.4)}

    /* å“åº”å¼ç»†èŠ‚ */
    @media (max-width:480px){ .rec{padding:12px} .toolbar button{flex:1} }
  </style>
</head>
<body>
  <div class="badge">å°ç¥ç¦ Â· çº¯å‰ç«¯ Â· CSS ä¸‰è§’å‡½æ•°åŠ¨ç”»</div>

  <!-- ç™»å½•è’™å±‚ -->
  <div class="gate" id="gate">
    <div class="card">
      <div class="title">è¯·è¾“å…¥å°å¯†ç </div>
      <div class="muted">è¿™æ˜¯ä¸ªç®€å•çš„â€œå‡†ç§å¯†â€é¡µé¢ã€‚å¦‚æœæƒ³çœŸæ­£è´¦å·ä½“ç³»ï¼Œåç»­å¯æ¥å…¥ Firebase/Supabaseã€‚</div>
      <div class="field"><input id="pwd" class="input" placeholder="æ¯”å¦‚ï¼š5201314" /></div>
      <button class="btn" id="enter">è¿›å…¥</button>
      <div class="small">æç¤ºï¼šå¯åœ¨ <code>--passcode</code> è‡ªå®šä¹‰å¯†ç ï¼›æ­¤æ–¹å¼ä»…é€‚åˆè½»åœºæ™¯ã€‚</div>
    </div>
  </div>

  <!-- èˆå° -->
  <main class="stage">
    <!-- èƒŒæ™¯å…‰ç‚¹ï¼šä½¿ç”¨ CSS sin()/cos() å½¢æˆæè¨å¦‚æ›²çº¿ -->
    <div class="orbs" aria-hidden="true">
      <div class="orb" data-i="1"></div>
      <div class="orb" data-i="2"></div>
      <div class="orb" data-i="3"></div>
      <div class="orb" data-i="4"></div>
      <div class="orb" data-i="5"></div>
    </div>

    <!-- é£˜å¿ƒ -->
    <div class="hearts" id="hearts" aria-hidden="true"></div>

    <!-- ç¥ç¦æ–‡æ¡ˆé¢æ¿ -->
    <section class="panel">
      <div class="bless" id="bless"></div>
      <div class="sign" id="sign">â€” æ¥è‡ªæœ€å¥½çš„æœ‹å‹</div>
    </section>

    <!-- å½•åˆ¶åŒºï¼ˆåŸºäº MediaRecorderï¼Œçº¯å‰ç«¯å­˜æœ¬åœ°ï¼‰ -->
    <section class="rec">
      <div class="toolbar">
        <button id="openCam" class="primary">æ‰“å¼€æ‘„åƒå¤´</button>
        <button id="startRec">å¼€å§‹å½•åˆ¶</button>
        <button id="stopRec" disabled>åœæ­¢å¹¶é¢„è§ˆ</button>
        <button id="saveRec" disabled>ä¸‹è½½è§†é¢‘</button>
      </div>
      <video id="player" playsinline controls></video>
    </section>
  </main>

  <script>
    // â€”â€” ç®€æ˜“â€œç™»å½•â€ â€”â€”
    const gate = document.getElementById('gate');
    const input = document.getElementById('pwd');
    document.getElementById('enter').addEventListener('click', () => {
      const want = getComputedStyle(document.documentElement).getPropertyValue('--passcode').replaceAll('"','').trim();
      if((input.value || '').trim() === want){ gate.classList.add('hide'); } 
      else { input.value=''; input.placeholder='å¯†ç ä¸å¯¹ï¼Œå†è¯•ä¸€æ¬¡ï½'; }
    });

    // æ”¯æŒå›è½¦
    input.addEventListener('keydown', e=>{ if(e.key==='Enter') document.getElementById('enter').click(); });

    // â€”â€” ç¥ç¦æ–‡æ¡ˆï¼šæ”¯æŒ URL æŸ¥è¯¢å‚æ•° ?msg=xxx&from=yyy â€”â€”
    const Bless = document.getElementById('bless');
    const params = new URLSearchParams(location.search);
    const msg = params.get('msg') || getComputedStyle(document.documentElement).getPropertyValue('--msg').replaceAll('"','').trim();
    const from = params.get('from') || '';
    Bless.textContent = msg;
    if(from) document.getElementById('sign').textContent = `â€” ${from}`;

    // â€”â€” é£˜å¿ƒï¼šç”Ÿæˆä¸€äº›ä¸åŒçš„éšæœºå¿ƒå½¢ â€”â€”
    const hearts = document.getElementById('hearts');
    const rand = (a,b)=> a + Math.random()*(b-a);
    for(let i=0;i<60;i++){
      const h = document.createElement('div'); h.className='heart';
      h.style.left = rand(0, 100) + 'vw';
      h.style.animationDelay = rand(-6, 0) + 's';
      h.style.animationDuration = rand(4, 10) + 's';
      h.style.transform = `translateY(${rand(10,80)}vh) rotate(45deg)`;
      h.style.opacity = rand(.4,.95);
      h.style.width = rand(10,22) + 'px';
      hearts.appendChild(h);
    }

    // â€”â€” å½•åˆ¶åŠŸèƒ½ï¼ˆçº¯å‰ç«¯ï¼‰ â€”â€”
    const openCam = document.getElementById('openCam');
    const startRec = document.getElementById('startRec');
    const stopRec = document.getElementById('stopRec');
    const saveRec = document.getElementById('saveRec');
    const player = document.getElementById('player');

    let mediaStream = null, recorder = null, chunks = [];

    openCam.onclick = async () => {
      try{
        mediaStream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
        player.srcObject = mediaStream; player.muted = true; player.play();
      }catch(e){ alert('æ— æ³•æ‰“å¼€æ‘„åƒå¤´/éº¦å…‹é£ï¼š' + e.message); }
    };

    startRec.onclick = () => {
      if(!mediaStream){ alert('è¯·å…ˆæ‰“å¼€æ‘„åƒå¤´'); return; }
      chunks = [];
      recorder = new MediaRecorder(mediaStream, { mimeType: 'video/webm;codecs=vp9,opus' });
      recorder.ondataavailable = (e)=>{ if(e.data.size>0) chunks.push(e.data); };
      recorder.onstop = ()=>{
        const blob = new Blob(chunks, { type: 'video/webm' });
        player.srcObject = null; player.src = URL.createObjectURL(blob); player.muted = false; player.play();
        saveRec.disabled = false; saveRec.onclick = () => {
          const a = document.createElement('a');
          a.href = player.src; a.download = `wedding-greet-${Date.now()}.webm`;
          document.body.appendChild(a); a.click(); a.remove();
        };
      };
      recorder.start();
      startRec.disabled = true; stopRec.disabled = false;
    };

    stopRec.onclick = () => {
      if(recorder && recorder.state !== 'inactive'){ recorder.stop(); }
      stopRec.disabled = true; startRec.disabled = false;
    };

    // â€”â€” å°æŠ–åŠ¨ï¼šç¥ç¦æ–‡æ¡ˆå‘¼å¸/å¾‹åŠ¨ï¼ˆç»§ç»­ç”¨ä¸‰è§’å‡½æ•°ï¼‰ â€”â€”
    // é€šè¿‡åŠ¨ç”»å˜é‡ --t å®ç°æ°´å¹³è½»å¾®æ‘†åŠ¨ï¼šx = sin(t)*2px
    const style = document.createElement('style');
    style.textContent = `
      @property --t { syntax: '<angle>'; inherits: false; initial-value: 0deg; }
      .bless { --t: 0deg; animation: wave 8s linear infinite; }
      @keyframes wave { 0%{--t:0deg} 100%{--t:360deg} }
      .bless{ transform: translateX(calc(sin(var(--t))*6px)); }
    `;
    document.head.appendChild(style);

    // â€”â€” å®‰å…¨æç¤º â€”â€”
    console.log('%cæ³¨æ„ï¼šå½“å‰å¯†ç æ˜¯å‰ç«¯æ˜æ–‡ï¼Œé€‚åˆä¸€æ¬¡æ€§/è½»é‡ç”¨é€”ã€‚è¦çœŸæ­£ç§å¯†è¯·æ”¹ç”¨åç«¯/é‰´æƒæœåŠ¡ã€‚','background:#ffd1e3;color:#530; padding:4px 8px; border-radius:6px;');
  </script>
</body>
</html>
